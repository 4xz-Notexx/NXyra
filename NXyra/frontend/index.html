<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NXyra AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= THEME VARIABLES ================= */
:root{
    --bg-main: rgba(2,6,23,.95);
    --bg-soft: #1e293b;
    --text-main: #e5e7eb;
    --user-msg: #2563eb;
    --bot-msg: #1e293b;
}

body.light{
    --bg-main: #f8fafc;
    --bg-soft: #e5e7eb;
    --text-main: #020617;
    --bot-msg: #e5e7eb;
}

/* ================= BASE ================= */
body{
    margin:0;
    height:100vh;
    font-family:"Segoe UI",sans-serif;
    background:linear-gradient(-45deg,#020617,#0f172a,#020617);
    background-size:400% 400%;
    animation:bg 12s ease infinite;
    display:flex;
    justify-content:center;
    align-items:center;
    color:var(--text-main);
    overflow:hidden;
}
@keyframes bg{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
}

/* ================= BACKGROUND CANVAS ================= */
#bgCanvas{
    position:fixed;
    inset:0;
    z-index:-1;
}

/* ================= CHAT ================= */
.chat{
    width:440px;
    height:740px;
    background:var(--bg-main);
    backdrop-filter:blur(6px);
    border-radius:18px;
    display:flex;
    flex-direction:column;
    box-shadow:0 30px 80px rgba(0,0,0,.9);
}

/* ================= HEADER ================= */
.header{
    padding:12px;
    border-bottom:1px solid #334155;
    display:flex;
    justify-content:space-between;
    font-size:12px;
}
.header a{
    color:#38bdf8;
    cursor:pointer;
    text-decoration:none;
}

/* ================= NOTE ================= */
.note{
    background:var(--bg-soft);
    color:#facc15;
    padding:8px;
    text-align:center;
    font-size:12px;
}

/* ================= MESSAGES ================= */
.messages{
    flex:1;
    padding:14px;
    overflow-y:auto;
}
.msg{
    max-width:80%;
    padding:10px 12px;
    border-radius:12px;
    margin-bottom:10px;
    animation:fade .2s ease;
}
@keyframes fade{
    from{opacity:0;transform:translateY(5px)}
    to{opacity:1}
}
.user{background:var(--user-msg);margin-left:auto;color:white}
.bot{background:var(--bot-msg)}

/* ================= INPUT ================= */
.input{
    display:flex;
    padding:10px;
    border-top:1px solid #334155;
}
.input input{
    flex:1;
    padding:10px;
    border-radius:10px;
    border:none;
    outline:none;
}
.input button{
    margin-left:6px;
    padding:10px 14px;
    border-radius:10px;
    border:none;
    background:#2563eb;
    color:white;
    cursor:pointer;
}
.clear-btn{background:#ef4444!important}

/* ================= FOOTER ================= */
.footer{
    font-size:10px;
    text-align:center;
    padding:6px;
    opacity:.6;
}

/* ================= MODALS ================= */
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    justify-content:center;
    align-items:center;
}
.modal-box{
    background:var(--bg-main);
    padding:20px;
    border-radius:12px;
    width:300px;
    text-align:center;
}
.modal-box textarea{
    width:100%;
    height:80px;
    border-radius:8px;
    border:1px solid #334155;
    background:var(--bg-soft);
    color:var(--text-main);
    padding:8px;
}
</style>
</head>

<body>

<canvas id="bgCanvas"></canvas>

<div class="chat">

    <!-- HEADER -->
    <div class="header">
        <div>
            <b>NXyra AI ü§ñ</b><br>
            <small>Hybrid Math Chatbot</small>
        </div>
        <div>
            <a href="https://github.com/4xz-Notexx" target="_blank">GitHub</a> |
            <a href="https://www.linkedin.com/in/anas-ahmad-527227386/" target="_blank">LinkedIn</a> |
            <a onclick="openAbout()">About</a> |
            <a onclick="toggleTheme()">üåô/‚òÄÔ∏è</a>
        </div>
    </div>

    <!-- NOTE -->
    <div class="note">
        ‚ö†Ô∏è Currently, NXyra answers only simple mathematical expressions
        (e.g. 5+7, (10+2)*3)
    </div>

    <!-- CHAT -->
    <div class="messages" id="messages"></div>

    <!-- INPUT -->
    <div class="input">
        <input id="msg" placeholder="Enter a math expression..."
               onkeydown="if(event.key==='Enter') send()">
        <button onclick="startVoice()">üé§</button>
        <button onclick="send()">Send</button>
        <button onclick="openFeedback()">Feedback</button>
        <button onclick="clearChat()" class="clear-btn">Clear</button>
    </div>

    <div class="footer">
        üë®‚Äçüíª Developed by <b>Anas Ahmad</b> ‚Ä¢ NXyra v1.0
    </div>

</div>

<!-- FEEDBACK MODAL -->
<div class="modal" id="fb">
    <div class="modal-box">
        <h3>Feedback</h3>
        <textarea id="fbText"></textarea><br><br>
        <button onclick="submitFeedback()">Send</button>
        <button onclick="closeFeedback()">Cancel</button>
    </div>
</div>

<!-- ABOUT MODAL -->
<div class="modal" id="aboutModal">
    <div class="modal-box">
        <img src="profile.png"
             style="width:90px;height:90px;border-radius:50%;
                    object-fit:cover;border:3px solid #2563eb;margin-bottom:10px;">
        <h3>Anas Ahmad</h3>
        <p style="font-size:13px;opacity:.8;">
            B.Tech (AI & ML) Student<br>
            Developer of NXyra
        </p>
        <p style="font-size:12px;">
            Passionate about AI, Web Development, and building real-world projects.
        </p>
        <button onclick="closeAbout()">Close</button>
    </div>
</div>

<audio id="replySound">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3">
</audio>

<script>
/* ================= AUTO GREETING ================= */
window.onload = () => {
    messages.innerHTML += `
    <div class="msg bot">
        üòäü§ñ Hello!<br><br>
        I‚Äôm <b>NXyra</b>, a hybrid math chatbot.<br><br>
        Developed by <b>Anas Ahmad</b>.<br><br>
        I currently answer only basic mathematical expressions.<br><br>
        üöß Under active development.
    </div>`;
};

/* ================= CHAT ================= */
function addSmartEmoji(text){
    const t=text.toLowerCase();
    if(t.includes("hello")||t.includes("nxyra")) return "üòäü§ñ "+text;
    if(t.includes("answer")) return "üßÆ‚úÖ "+text;
    if(t.includes("only")||t.includes("development")) return "‚ö†Ô∏èüöß "+text;
    return "ü§ñ "+text;
}

function send(){
    const t=msg.value.trim();
    if(!t)return;
    messages.innerHTML+=`<div class="msg user">${t}</div>`;
    msg.value="";

    const typing=document.createElement("div");
    typing.className="msg bot";
    typing.id="typing";
    typing.innerText="NXyra is typing...";
    messages.appendChild(typing);

    fetch("http://127.0.0.1:5000/chat",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message:t})
    }).then(r=>r.json()).then(d=>{
        typing.remove();
        messages.innerHTML+=`<div class="msg bot">${addSmartEmoji(d.reply)}</div>`;
        replySound.play();
        messages.scrollTop=messages.scrollHeight;
    });
}

function clearChat(){messages.innerHTML=""}

/* ================= VOICE ================= */
function startVoice(){
    if(!('webkitSpeechRecognition'in window))
        return alert("Voice not supported");
    const r=new webkitSpeechRecognition();
    r.lang="en-US";
    r.onresult=e=>msg.value=e.results[0][0].transcript;
    r.start();
}

/* ================= FEEDBACK ================= */
function openFeedback(){fb.style.display="flex"}
function closeFeedback(){fb.style.display="none"}
function submitFeedback(){
    if(!fbText.value.trim())return alert("Write feedback");
    fetch("http://127.0.0.1:5000/feedback",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message:fbText.value})
    }).then(r=>r.json()).then(d=>{
        alert(d.status);
        fbText.value="";
        closeFeedback();
    });
}

/* ================= ABOUT ================= */
function openAbout(){aboutModal.style.display="flex"}
function closeAbout(){aboutModal.style.display="none"}

/* ================= THEME ================= */
function toggleTheme(){
    document.body.classList.toggle("light");
    localStorage.setItem("theme",
        document.body.classList.contains("light")?"light":"dark");
}
if(localStorage.getItem("theme")==="light")
    document.body.classList.add("light");

/* ================= BACKGROUND PARTICLES ================= */
const c=bgCanvas,ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();onresize=resize;
let dots=[...Array(80)].map(()=>({
    x:Math.random()*c.width,
    y:Math.random()*c.height,
    r:Math.random()*1.5+0.5,
    s:Math.random()*0.4+0.2
}));
(function animate(){
    ctx.clearRect(0,0,c.width,c.height);
    ctx.fillStyle="rgba(255,255,255,.7)";
    dots.forEach(d=>{
        ctx.beginPath();
        ctx.arc(d.x,d.y,d.r,0,6.28);
        ctx.fill();
        d.y+=d.s;
        if(d.y>c.height)d.y=0;
    });
    requestAnimationFrame(animate);
})();
</script>

</body>
</html>
